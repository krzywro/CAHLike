@inherits LayoutComponentBase
@inject AppState state

<div class="sidebar">
    <NavMenu />
</div>

<div class="main">
    <div class="top-row px-4">
        <a href="http://blazor.net" target="_blank" class="ml-md-auto">About</a>
    </div>

    <div class="content px-4">
        @Body
    </div>

    @if (greetingVisible)
    {
        <div aria-live="polite" aria-atomic="true" style="">
            <div class="toast show bg-success text-white" style="position: absolute; top: 4rem; right: 0; z-index: 10000">
                <div class="toast-header">
                    <strong class="mr-auto">Server greets you!</strong>
                    <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close" @onclick="@(e => greetingVisible = false)">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
            </div>
        </div>
    }
</div>

@code 
{
    private bool greetingVisible = false;

    protected override async Task OnInitializedAsync()
    {

        state.ServerGreeting += () => { greetingVisible = false; StateHasChanged(); };
        await state.EnsurePlayerHubConnection();

        await state.RegisterPlayer();
    }
}